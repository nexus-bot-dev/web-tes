<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRIS Payment Generator & Status Checker</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
        }
        h1 {
            color: #1a73e8;
            text-align: center;
            margin-bottom: 25px;
        }
        .balance-box {
            background-color: #e8f0fe;
            color: #1a73e8;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        input[type="number"] {
            width: 95%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 17px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover:not(:disabled) {
            background-color: #1e7e34;
        }
        .qris-display {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 8px;
            text-align: center;
            display: none; /* Sembunyikan secara default */
        }
        .qris-display img {
            max-width: 80%;
            height: auto;
            border: 5px solid #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .status-info {
            margin-top: 15px;
            font-size: 1.1em;
            font-weight: bold;
        }
        .success-animation {
            font-size: 4em;
            color: #28a745;
            display: none;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ðŸ’µ QRIS Payment & Saldo Cek</h1>

        <div class="balance-box">
            Saldo Anda: <span id="currentBalance">Memuat...</span>
        </div>

        <label for="amountInput">Jumlah Deposit (Min. 1000):</label>
        <input type="number" id="amountInput" value="1000" min="1000">

        <button id="generateBtn" onclick="generateQRIS()">Generate QRIS</button>

        <div class="qris-display" id="qrisDisplay">
            <h3>Scan QRIS di Bawah</h3>
            <p>ID Transaksi: <strong id="trxIdDisplay"></strong></p>
            <img id="qrisImage" src="" alt="QRIS Code">
            <p>Total Bayar: <strong id="totalAmountDisplay"></strong></p>
            <div class="status-info" id="statusInfo">Menunggu Pembayaran...</div>
            <div class="success-animation" id="successAnim">âœ…</div>
        </div>
    </div>

    <script>
        // *** KONFIGURASI API KEY ANDA ***
        const API_KEY = "b67ff890-491c-4732-9ed4-453514fcccaa";
        const DEPOSIT_URL = "https://my-payment.autsc.my.id/api/deposit";
        
        // Asumsi URL Cek Saldo dan Cek Transaksi (HARUS DIGANTI DENGAN ENDPOINT ASLI)
        const BALANCE_URL = "https://my-payment.autsc.my.id/api/balance"; // ASUMSI
        const CHECK_URL = "https://my-payment.autsc.my.id/api/check"; // ASUMSI

        let currentTrxId = null;
        let checkInterval = null;

        // --- 1. Fungsi Format Rupiah ---
        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(number);
        }
        
        // --- 2. Fungsi Cek Saldo (Jika ada API-nya) ---
        async function fetchBalance() {
            try {
                // Di sini, Anda harus mengganti dengan endpoint API Cek Saldo yang sebenarnya
                const response = await fetch(`${BALANCE_URL}?apikey=${API_KEY}`); 
                // Karena API cek saldo tidak disediakan, kita akan tampilkan saldo default
                document.getElementById('currentBalance').textContent = "Rp 1.000.000"; 
            } catch (error) {
                console.error("Gagal mengambil saldo:", error);
                document.getElementById('currentBalance').textContent = "Gagal (API tidak ditemukan)";
            }
        }

        // --- 3. Fungsi Generate QRIS ---
        async function generateQRIS() {
            const amount = document.getElementById('amountInput').value;
            if (parseInt(amount) < 1000) {
                alert("Jumlah deposit minimal adalah 1000.");
                return;
            }

            // Nonaktifkan tombol saat proses
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('generateBtn').textContent = 'Memproses...';
            
            // Hentikan interval pengecekan sebelumnya (jika ada)
            if (checkInterval) clearInterval(checkInterval);
            document.getElementById('qrisDisplay').style.display = 'none';
            document.getElementById('successAnim').style.display = 'none';

            try {
                const url = `${DEPOSIT_URL}?amount=${amount}&apikey=${API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();

                if (data.status === 'success') {
                    const trx = data.data;
                    currentTrxId = trx.transaction_id;

                    // Tampilkan QRIS
                    document.getElementById('trxIdDisplay').textContent = trx.transaction_id;
                    document.getElementById('qrisImage').src = trx.qris_url;
                    document.getElementById('totalAmountDisplay').textContent = formatRupiah(trx.total_amount);
                    document.getElementById('statusInfo').textContent = 'Menunggu Pembayaran...';
                    document.getElementById('statusInfo').style.color = '#ff9800'; // Orange
                    document.getElementById('qrisDisplay').style.display = 'block';

                    // Mulai pengecekan status setiap 5 detik
                    checkInterval = setInterval(checkTransactionStatus, 5000); 

                } else {
                    alert('Gagal membuat QRIS: ' + (data.message || 'Respons tidak valid'));
                }

            } catch (error) {
                console.error('Error saat generate QRIS:', error);
                alert('Terjadi kesalahan koneksi.');
            } finally {
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('generateBtn').textContent = 'Generate QRIS';
            }
        }

        // --- 4. Fungsi Cek Status Transaksi ---
        async function checkTransactionStatus() {
            if (!currentTrxId) return;

            try {
                // ASUMSI: API Cek Status mengembalikan status 'flash' jika dibayar
                const checkUrl = `${CHECK_URL}?transaction_id=${currentTrxId}&apikey=${API_KEY}`;
                
                // Karena API check tidak disediakan, kita akan buat simulasi
                // Ganti kode di bawah dengan panggilan API yang sebenarnya:
                /* const response = await fetch(checkUrl);
                const data = await response.json(); 
                const status = data.data.status; 
                */
                
                // SIMULASI (Hapus ini jika API check sudah tersedia):
                const statusList = ['pending', 'pending', 'pending', 'flash'];
                const randomStatus = statusList[Math.floor(Math.random() * statusList.length)]; // Simulasi 25% chance of 'flash'
                const status = randomStatus; 

                // Logika Pengecekan
                if (status === 'flash') {
                    clearInterval(checkInterval); // Hentikan pengecekan
                    document.getElementById('statusInfo').textContent = 'Pembayaran Berhasil! Saldo ditambahkan.';
                    document.getElementById('statusInfo').style.color = '#28a745'; // Hijau
                    document.getElementById('successAnim').style.display = 'block'; // Tampilkan animasi
                    fetchBalance(); // Perbarui saldo
                } else if (status === 'expired' || status === 'failed') {
                    clearInterval(checkInterval);
                    document.getElementById('statusInfo').textContent = 'Transaksi Kadaluarsa atau Gagal.';
                    document.getElementById('statusInfo').style.color = '#dc3545'; // Merah
                } else {
                    document.getElementById('statusInfo').textContent = `Menunggu Pembayaran... (ID: ${currentTrxId})`;
                    document.getElementById('statusInfo').style.color = '#ff9800';
                }

            } catch (error) {
                console.error('Error saat cek status:', error);
                // Biarkan interval berjalan, coba lagi
            }
        }

        // Panggil fungsi cek saldo saat halaman dimuat
        fetchBalance(); 
    </script>

</body>
</html>
